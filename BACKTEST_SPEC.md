# 🧪 Backtest Specification

> 본 문서는 Crypto Market Insight 프로젝트에서 사용되는
> 백테스트(Backtest) 도메인의 규칙, 가정, 계산 방식을 정의합니다.

백테스트 로직은 본 문서를 **단일 기준(Single Source of Truth)**으로 하여 구현됩니다.

---

## 1. 목적 및 범위

백테스트 기능의 목적은 다음과 같습니다.

- 기술적 지표 기반 전략의 과거 성과 검증
- 전략 간 성과 비교를 통한 의사결정 보조
- 실거래 이전 단계에서의 리스크 사전 확인

본 백테스트는 학습 및 전략 검증 목적으로 제공되며,
실제 시장 체결을 완전히 동일하게 재현하는 것을 목표로 하지는 않습니다.

---

## 2. 데이터 기준

### 2.1 데이터 소스

- 외부 가상자산 시세 API(`CoinGecko`)를 단일 데이터 소스로 사용
- 모든 지표 계산 및 백테스트는 동일 데이터 소스 기준으로 수행

### 2.2 데이터 단위

- OHLCV 캔들 데이터 기준
- 타임프레임 예시: `1h`, `4h`, `1d`
- 백테스트 기간은 서버 부하 및 비용 통제를 위해 제한됨

---

## 3. 전략 모델

### 3.1 전략 유형

규칙 기반(Rule-based) 전략을 사용하며, 전략은 다음 요소로 구성됩니다.

- 진입(Entry) 조건
- 청산(Exit) 조건
- 파라미터(지표 기간, 임계값 등)

### 3.2 전략 표현 방식

전략은 파라미터화된 설정 값으로 정의됩니다.

- RSI 기간
- RSI 진입 임계값
- 이동평균 기간

> 전략 정의 자체는 데이터와 분리된 형태로 관리됩니다.

---

## 4. 시그널 생성 규칙

- 각 캔들 단위로 기술적 지표를 계산
- 계산된 지표를 기준으로 진입/청산 조건 평가
- 하나의 캔들에서는 하나의 시그널만 평가

> 시그널 생성 시점에는 미래 데이터가 참조되지 않습니다.

---

## 5. 체결(Execution) 규칙

### 5.1 체결 시점

진입/청산 시그널 발생 후
**다음 캔들 시가(Open)** 기준 체결을 원칙으로 합니다.

> 이는 룩어헤드 바이어스(Look-ahead Bias)를 방지하기 위한 설계입니다.

### 5.2 체결 가격

- 기본 체결 가격: 다음 캔들 시가
- 슬리피지 및 수수료는 체결 가격에 반영

---

## 6. 수수료 및 슬리피지

### 6.1 거래 수수료

- 고정 비율(예: `0.1%`) 적용
- 진입 및 청산 시 각각 반영

### 6.2 슬리피지

- 단순 모델 기반 고정 비율 적용
- 실제 시장 유동성을 완벽히 반영하지 않으며,
  보수적인 성과 평가를 위한 요소로 사용

---

## 7. 포지션 관리 규칙

- 기본 전략은 단일 포지션(single position) 기준
- 동일 시점 중복 진입 불가
- 포지션 보유 중에는 추가 진입 신호 무시
- 손절/익절 조건은 전략 파라미터로 선택 가능

---

## 8. 성과 지표 정의

백테스트 결과는 다음 지표를 기준으로 평가됩니다.

### 8.1 누적 수익률 (Cumulative Return)

- 초기 자본 대비 최종 자본 변화율

### 8.2 최대 낙폭 (Maximum Drawdown, MDD)

- 백테스트 기간 중 최고점 대비 최대 손실 비율

### 8.3 승률 (Win Rate)

- 전체 거래 중 수익 거래 비율

### 8.4 거래 횟수

- 전략 실행 동안 발생한 총 거래 수

> 성과 지표는 비교 및 참고 목적으로 제공됩니다.

---

## 9. 편향 방지 원칙

백테스트 신뢰도를 높이기 위해 다음 원칙을 적용합니다.

- 미래 캔들 데이터 참조 금지
- 시그널 발생 캔들에서 즉시 체결 금지
- 동일 데이터 소스 기준 일관된 계산
- 과도한 파라미터 최적화(Overfitting) 지양

---

## 10. 한계 및 유의사항

본 백테스트는 실제 거래 환경을 단순화한 모델입니다.

- 유동성 부족, 급격한 가격 변동, 거래소 장애 등은 반영되지 않습니다.
- 결과는 투자 성과를 보장하지 않습니다.

---

## 11. 정리

본 백테스트 스펙은
**일관성, 재현성, 편향 방지**를 우선으로 설계되었습니다.

이는 복잡한 금융 시뮬레이터가 아닌,
전략 검증과 학습을 위한 현실적인 기준선을 제공하는 것을 목표로 합니다.
