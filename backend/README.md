# ⚙️ Backend – Crypto Market Insight

## 1. 백엔드 역할 개요

본 백엔드는 가상자산 시장 데이터를 기반으로
시세 조회 → 데이터 가공 → 지표 계산 → 전략 백테스트로 이어지는
분석 파이프라인을 제공하는 역할을 담당합니다.

특히 시계열 데이터의 특성과 비용 효율성을 고려하여
원본 데이터의 장기 저장을 지양하고,
요청 기반 처리와 캐싱 전략을 중심으로 설계되었습니다.

---

## 2. 전체 책임 범위

> API Documentation  
> [Swagger UI](/swagger-ui/index.html)

- 외부 가상자산 시세 API 연동
- 체인/생태계 기준 코인 메타 정보 관리
- 기술적 지표 계산
- 전략 백테스트 시뮬레이션
- 사용자 전략 및 결과 데이터 관리
- OAuth2 기반 인증 처리
- 캐싱 및 비용 통제

---

## 3. 패키지 구조 (Overview)

```bash
com.crypto.insight
├── common        # 공통 DTO, 예외, 유틸리티
├── config        # 애플리케이션 및 외부 연동 설정
├── domain        # 도메인별 비즈니스 로직
│   ├── market    # 시세 조회 및 지표 계산
│   ├── strategy  # 전략 정의 및 백테스트
│   ├── portfolio # 모의 투자 및 포지션 관리
│   └── user      # 사용자 및 인증 연관 도메인
└── security      # OAuth2 기반 인증/인가
```

패키지는 도메인 중심으로 구성하여
기능 확장 시 의존성 증가를 최소화하는 구조를 지향합니다.

---

## 4. 시세 데이터 처리 흐름

### 4.1 외부 시세 API 연동

시세 및 OHLCV 데이터는 CoinGecko API를 통해 조회

데이터는 요청 시점에만 조회하며, 원본 데이터는 DB에 저장하지 않음

데이터 소스 특성에 따른 가격 오차 가능성을 고려하여
분석/백테스트는 동일 소스 기준으로 수행

### 4.2 캐싱 전략

반복 요청이 많은 시세/캔들 데이터는 서버 메모리 캐시(Caffeine) 적용

캐시 대상:

- 최근 캔들 데이터
- 지표 계산 결과
- TTL을 짧게 설정하여 데이터 최신성 유지

이를 통해 외부 API 호출 횟수와 응답 지연을 최소화합니다.

---

## 5. 기술적 지표 계산

- MA / EMA, RSI, MACD, Bollinger Bands 등 주요 지표 제공
- 지표는 요청 시 계산하거나 캐시된 데이터 활용
- 지표 계산 로직은 시세 조회 로직과 분리하여 관리

지표 계산은 정확성보다 일관성을 우선하며, 동일한 데이터 소스를 기준으로 결과를 산출합니다.

---

## 6. 전략 백테스트 처리 흐름

> 본 프로젝트의 백테스트 로직 및 체결/성과 지표 정의는  
> [BACKTEST_SPEC.md](../BACKTEST_SPEC.md)에 별도로 정리되어 있습니다.

- 사용자가 전략 및 파라미터 선택
- 지정된 기간의 시세 데이터 조회
- 전략 규칙에 따라 매수/매도 시그널 생성
- 가상 체결 및 포지션 시뮬레이션
- 성과 지표(누적 수익률, MDD, 승률 등) 계산
- 결과 요약 정보만 데이터베이스에 저장

백테스트는 기간 및 대상 코인 수를 제한하여
서버 자원 사용을 통제합니다.

---

## 7. 데이터베이스 사용 원칙

데이터베이스는 트랜잭션 성격의 데이터만 저장하는 용도로 사용합니다.

- 저장 대상
- 사용자 정보
- 즐겨찾기 코인
- 전략 정의 및 파라미터
- 백테스트 결과 요약
- 모의 투자 계좌/주문/체결 정보
- 저장하지 않는 데이터
- 원본 시세 및 캔들 데이터
- 대량 시계열 분석 데이터

이를 통해 DB 용량 증가와 인덱스 관리 비용을 최소화합니다.

---

## 8. 인증 및 보안

- OAuth2 기반 로그인
- 인증 책임을 외부 제공자에 위임하여 보안 부담 최소화
- 백엔드는 인증된 사용자 식별 및 권한 검증에 집중

본 프로젝트에서는 인증 구현 자체보다 서비스 도메인 로직에 집중하는 것을 목표로 합니다.

---

## 9. 예외 처리 전략

- 비즈니스 로직 오류는 ErrorCode 기반 예외로 통합 관리

- 모든 예외는 글로벌 예외 처리기를 통해 일관된 응답 포맷으로 반환

이를 통해 프론트엔드와의 명확한 책임 분리를 유지합니다.

---

## 10. 테스트 전략

- 핵심 비즈니스 로직 중심의 테스트 작성
- 단위 테스트와 통합 테스트를 구분하여 관리

Testing Tools

`JUnit 5` `Spring Boot Test`

테스트 상세 구현은 각 도메인 단위로 관리합니다.

---

## 11. 운영 및 확장 고려 사항

- 컨테이너 기반 배포를 통해 환경 의존성 최소화
- Spring Actuator 및 Micrometer 기반 메트릭 노출
- 필요 시 Prometheus/Grafana 연동 가능한 구조

본 백엔드는 소규모 트래픽부터 확장 가능한 구조를 전제로 설계되었습니다.

---

## 12. 정리

본 백엔드는
가상자산 시계열 데이터의 특성, 비용 효율성, 확장성을 고려하여
요청 기반 처리와 명확한 도메인 분리를 중심으로 설계되었습니다.

이는 포트폴리오 목적의 프로젝트이지만,
실제 서비스 환경에서도 적용 가능한 구조를 목표로 합니다.
